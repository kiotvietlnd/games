<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE CHOSEN ONE - KiotViet Training</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary: #00A9E0;
            --secondary: #005595;
            --accent: #00FFCC;
            --bg: #030712;
            --panel: rgba(255, 255, 255, 0.05);
            --border: rgba(0, 169, 224, 0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            background-image: radial-gradient(circle at 50% -20%, rgba(0, 169, 224, 0.2) 0%, transparent 50%);
            color: #fff; height: 100vh; display: flex; flex-direction: column; overflow: hidden;
        }

        header {
            padding: 15px 40px; display: flex; justify-content: space-between; align-items: center;
            background: rgba(0, 0, 0, 0.8); border-bottom: 2px solid var(--secondary);
        }

        .logo-text { font-size: 28px; font-weight: 900; letter-spacing: 5px; text-shadow: 0 0 15px var(--primary); text-transform: uppercase; }

        .mode-selector { display: flex; background: rgba(255, 255, 255, 0.05); padding: 5px; border-radius: 12px; border: 1px solid var(--border); }

        .mode-btn {
            border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;
            font-weight: 800; font-size: 12px; color: #666; background: transparent; transition: 0.3s;
        }

        .mode-btn.active { background: var(--primary); color: white; box-shadow: 0 0 20px rgba(0, 169, 224, 0.5); }

        .main-grid { display: grid; grid-template-columns: 320px 1fr 450px; gap: 20px; padding: 20px; flex: 1; }

        .panel { background: var(--panel); border: 1px solid var(--border); border-radius: 20px; backdrop-filter: blur(15px); padding: 20px; display: flex; flex-direction: column; }

        textarea { flex: 1; background: rgba(0, 0, 0, 0.5); border: 1px solid var(--border); border-radius: 12px; color: #00FFCC; padding: 15px; font-size: 14px; resize: none; outline: none; }

        .game-zone { display: flex; flex-direction: column; align-items: center; justify-content: center; }

        .winner-name { font-size: 60px; font-weight: 900; text-shadow: 0 0 30px var(--primary); text-align: center; min-height: 80px; margin-bottom: 20px; }

        .spin-btn {
            width: 180px; height: 180px; border-radius: 50%;
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            border: 8px solid rgba(255,255,255,0.1); color: white; font-size: 22px; font-weight: 900;
            cursor: pointer; box-shadow: 0 0 40px rgba(0, 85, 149, 0.6); transition: 0.3s;
        }

        .spin-btn:hover:not(:disabled) { transform: scale(1.05); }

        .scenario-box { background: rgba(0, 0, 0, 0.4); border: 1px solid var(--border); padding: 20px; border-radius: 18px; flex: 1; overflow-y: auto; font-size: 13px; line-height: 1.5; }

        .tag { background: rgba(0, 255, 204, 0.1); color: var(--accent); border: 1px solid var(--accent); padding: 3px 10px; border-radius: 20px; font-size: 10px; font-weight: 800; margin-bottom: 8px; display: inline-block; }

        .sc-title { font-size: 16px; font-weight: 800; color: #fff; margin-bottom: 10px; border-bottom: 1px solid var(--border); padding-bottom: 5px; }

        .sc-step { margin-bottom: 8px; color: #ccc; }
        .sc-step b { color: var(--accent); }

        .history-item { font-size: 11px; color: #52525b; padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: space-between; }
    </style>
</head>
<body>

    <header>
        <div class="logo-text">THE CHOSEN ONE</div>
        <div class="mode-selector">
            <button class="mode-btn active" id="btnMode1" onclick="setMode(1)">BUỔI 1: LUỒNG CƠ BẢN</button>
            <button class="mode-btn" id="btnMode2" onclick="setMode(2)">BUỔI 2: HỎI ĐÁP</button>
        </div>
    </header>

    <div class="main-grid">
        <div class="panel">
            <h2 style="font-size: 11px; color: var(--accent); margin-bottom: 10px;">DANH SÁCH CHIẾN BINH</h2>
            <textarea id="nameList" placeholder="Nhập tên học viên..."></textarea>
            <div id="countDisplay" style="text-align: center; font-size: 11px; margin-top: 10px; color: var(--secondary); font-weight: 800;">0 ĐANG ĐỢI</div>
        </div>

        <div class="game-zone">
            <div id="winnerName" class="winner-name">---</div>
            <button class="spin-btn" id="spinBtn" onclick="startSpin()">CHỌN NGAY</button>
            <div id="turnLabel" style="margin-top: 20px; font-weight: bold; color: var(--secondary);">LƯỢT THỨ: 0</div>
        </div>

        <div class="panel">
            <h2 style="font-size: 11px; color: var(--accent); margin-bottom: 10px;">THỬ THÁCH ĐỊNH MỆNH</h2>
            <div class="scenario-box" id="scenarioBox">
                <div style="text-align: center; opacity: 0.3; margin-top: 100px;">Bấm nút để gán nhiệm vụ...</div>
            </div>
            <div id="historyList" style="margin-top: 15px; max-height: 120px; overflow-y: auto;"></div>
            <button onclick="resetGame()" style="margin-top: 10px; background: none; border: 1px solid #333; color: #555; padding: 5px; font-size: 10px; cursor: pointer; border-radius: 5px;">HỆ THỐNG LÀM MỚI</button>
        </div>
    </div>

    <script>
        const BUOI1_MASTER = [
            {
                tag: "LUỒNG CƠ BẢN - TẠP HÓA",
                title: "Kịch bản: Cửa hàng Nước giải khát",
                steps: [
                    "<b>1. Hàng hóa:</b> Thêm 'Bia Tiger'. Đơn vị cơ bản (nhỏ nhất): Lon. Quy đổi (lớn hơn): Thùng = 24 Lon. Có Nhóm hàng, Giá bán, Giá vốn, Tồn kho.",
                    "<b>2. Nhập hàng:</b> Nhập 50 Thùng từ 'NCC Thiên Nga'. Có Số lượng, thêm NCC mới, thanh toán nợ NCC một phần (Lưu công nợ).",
                    "<b>3. Bán hàng:</b> Bán cho khách 'Anh Tuấn'. Bán 1 Thùng + 6 Lon lẻ. Thanh toán kết hợp: Tiền mặt + Chuyển khoản.",
                    "<b>4. Trả hàng:</b> Anh Tuấn trả lại 2 Lon lẻ. Tìm <b>hóa đơn gốc</b> để thực hiện trả hàng.",
                    "<b>5. Công nợ:</b> Vào Quản lý, tìm hóa đơn nợ của NCC Thiên Nga để lập phiếu chi trả nợ. Tìm khách Anh Tuấn để lập phiếu thu nợ.",
                    "<b>6. Báo cáo:</b> Hướng dẫn xem: Doanh thu tại Tổng quan; Xuất-Nhập-Tồn tại báo cáo Hàng hóa; Lợi nhuận thuần tại báo cáo Tài chính; Doanh thu trong ngày tại báo cáo Cuối ngày (dạng ngang)."
                ]
            },
            {
                tag: "LUỒNG CƠ BẢN - THỜI TRANG",
                title: "Kịch bản: Shop Váy Thiết Kế",
                steps: [
                    "<b>1. Hàng hóa:</b> Thêm 'Váy hoa nhí'. Đơn vị cơ bản: Chiếc. Có Nhóm hàng, Thuộc tính (Màu sắc/Size), Giá bán, Giá vốn, Tồn kho.",
                    "<b>2. Nhập hàng:</b> Nhập 100 chiếc từ 'Xưởng may Thanh'. Thêm NCC mới, lưu công nợ toàn bộ hóa đơn nhập.",
                    "<b>3. Bán hàng:</b> Bán cho khách 'Chị Lan'. Chọn nhiều Size khác nhau. Khách thanh toán Tiền mặt + Chuyển khoản.",
                    "<b>4. Trả hàng:</b> Chị Lan trả lại 1 chiếc do đổi ý. Tìm <b>hóa đơn gốc</b> để thực hiện trả hàng.",
                    "<b>5. Công nợ:</b> Vào Quản lý, thanh toán nợ cho Xưởng may Thanh. Lập phiếu thu nợ từ Chị Lan ngay trên màn hình quản lý đối tác.",
                    "<b>6. Báo cáo:</b> Hướng dẫn xem: Doanh thu theo thời gian (Tuần/Quý); Xem tồn kho chi tiết; Xem lợi nhuận thuần sau khi trừ chi phí phát sinh."
                ]
            }
        ];

        const BUOI2_MASTER = [
            { 
                title: "Người 1: Quản lý nhân viên & Hàng hóa", tag: "Thiết lập", 
                context: "Shop Mẹ & Bé cần tuyển nhân viên mới tên 'Lan'.", 
                tasks: "1. Tạo tài khoản nhân viên Lan.<br>2. Thêm 'Bỉm Nhật' (Có thuộc tính Size).<br>3. Thêm hàng dịch vụ 'Gói quà'.<br>4. <b>Tạo bảng giá sỉ</b> áp dụng cho khách mua > 10 cái.<br>5. Thêm nhanh SP ngay trên phiếu nhập." 
            },
            { 
                title: "Người 2: Giá vốn & Nhập hàng nâng cao", tag: "Nhập hàng", 
                context: "Cửa hàng điện thoại nhập lô hàng giá biến động.", 
                tasks: "1. Nhập nhiều mức giá cho cùng 1 SP.<br>2. Thay đổi giá bán ngay khi đang nhập hàng.<br>3. Giải thích cột 'Giá vốn trung bình'.<br>4. Tra cứu theo Nhóm hàng & Thuộc tính Màu sắc." 
            },
            { 
                title: "Người 3: Xử lý bán hàng & Trả hàng", tag: "Giao dịch", 
                context: "Khách đang thanh toán thì mua thêm đồ và trả lại đồ cũ.", 
                tasks: "1. Thêm nhanh hàng hóa chưa có để bán.<br>2. Thu nợ khách ngay trên màn hình bán hàng.<br>3. <b>Tạo phiếu trả hàng nhanh</b> (không cần hóa đơn gốc).<br>4. Thiết lập thời gian cho phép trả hàng 3 ngày." 
            },
            { 
                title: "Người 4: Khách hàng & Sổ quỹ", tag: "Quản lý & Sổ quỹ", 
                context: "Cuối tháng rà soát kho và thanh toán chi phí điện nước.", 
                tasks: "1. Tạo nhóm khách hàng VIP.<br>2. Phiếu kiểm kho toàn bộ.<br>3. Phiếu kiểm kho riêng nhóm Thực phẩm.<br>4. Lập phiếu chi tiền điện (2 triệu).<br>5. Thêm TK Ngân hàng mới." 
            },
            { 
                title: "Người 5 & 6: Ôn tập luồng 6 bước", tag: "Ôn tập", 
                context: "Gia dụng/Siêu thị mini: Nhập hàng - Bán hàng - Trả hàng - Xem báo cáo.", 
                tasks: "Thực hiện mượt mà luồng 6 bước cơ bản. Kiểm tra doanh thu và lợi nhuận thuần cuối ngày." 
            }
        ];

        let currentMode = 1;
        let spinCount = 0;
        let isSpinning = false;
        let poolS1 = [...BUOI1_MASTER];

        function getNames() { return document.getElementById('nameList').value.split('\n').filter(n => n.trim() !== ""); }
        function updateCount() { document.getElementById('countDisplay').innerText = `${getNames().length} ĐANG ĐỢI`; }
        document.getElementById('nameList').addEventListener('input', updateCount);

        function setMode(mode) {
            currentMode = mode;
            document.getElementById('btnMode1').classList.toggle('active', mode === 1);
            document.getElementById('btnMode2').classList.toggle('active', mode === 2);
            resetGame(false);
        }

        function resetGame(clearNames = true) {
            spinCount = 0; poolS1 = [...BUOI1_MASTER];
            document.getElementById('winnerName').innerText = "---";
            document.getElementById('turnLabel').innerText = "LƯỢT THỨ: 0";
            document.getElementById('scenarioBox').innerHTML = '<div style="text-align: center; opacity: 0.3; margin-top: 100px;">Bấm nút để gán nhiệm vụ...</div>';
            document.getElementById('historyList').innerHTML = "";
            if(clearNames) document.getElementById('nameList').value = "";
            updateCount();
        }

        function startSpin() {
            const names = getNames();
            if (names.length === 0) return alert("Hết học viên!");
            if (isSpinning) return;
            isSpinning = true;
            document.getElementById('spinBtn').disabled = true;
            let start = Date.now();
            const timer = setInterval(() => {
                document.getElementById('winnerName').innerText = names[Math.floor(Math.random() * names.length)];
                if (Date.now() - start > 1500) { clearInterval(timer); finishSpin(names); }
            }, 70);
        }

        function finishSpin(names) {
            const winIdx = Math.floor(Math.random() * names.length);
            const winner = names[winIdx];
            document.getElementById('winnerName').innerText = winner;
            spinCount++;
            document.getElementById('turnLabel').innerText = `LƯỢT THỨ: ${spinCount}`;
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });

            let task;
            if (currentMode === 1) {
                if (poolS1.length === 0) poolS1 = [...BUOI1_MASTER];
                const taskIdx = Math.floor(Math.random() * poolS1.length);
                task = poolS1[taskIdx];
                poolS1.splice(taskIdx, 1);
                
                let stepsHtml = task.steps.map(s => `<div class="sc-step">${s}</div>`).join("");
                document.getElementById('scenarioBox').innerHTML = `<span class="tag">${task.tag}</span><div class="sc-title">${task.title}</div>${stepsHtml}`;
            } else {
                task = BUOI2_MASTER[spinCount - 1] || BUOI2_MASTER[BUOI2_MASTER.length-1];
                document.getElementById('scenarioBox').innerHTML = `
                    <span class="tag">${task.tag}</span><div class="sc-title">${task.title}</div>
                    <div style="color:var(--primary); font-style:italic; margin-bottom:10px;">${task.context}</div>
                    <div style="color:#ccc; line-height:1.6;">${task.tasks}</div>
                `;
            }

            const updated = names.filter((_, i) => i !== winIdx);
            document.getElementById('nameList').value = updated.join('\n');
            updateCount();

            const h = document.createElement('div');
            h.className = 'history-item';
            h.innerHTML = `<span>${spinCount}. ${winner}</span><span>${task.tag}</span>`;
            document.getElementById('historyList').prepend(h);

            isSpinning = false;
            document.getElementById('spinBtn').disabled = false;
        }
    </script>
</body>
</html>
