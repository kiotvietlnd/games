<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE CHOSEN ONE - KiotViet Training</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary: #00A9E0;
            --secondary: #005595;
            --accent: #00FFCC;
            --bg: #030712;
            --panel: rgba(255, 255, 255, 0.05);
            --border: rgba(0, 169, 224, 0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            background-image: 
                radial-gradient(circle at 50% -20%, rgba(0, 169, 224, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 0% 100%, rgba(0, 85, 149, 0.1) 0%, transparent 40%);
            color: #fff;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        body::before {
            content: "";
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: linear-gradient(rgba(0, 169, 224, 0.03) 1px, transparent 1px),
                              linear-gradient(90deg, rgba(0, 169, 224, 0.03) 1px, transparent 1px);
            background-size: 30px 30px;
            z-index: -1;
        }

        header {
            padding: 15px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.8);
            border-bottom: 2px solid var(--secondary);
        }

        .logo-text {
            font-size: 28px;
            font-weight: 900;
            letter-spacing: 5px;
            color: #fff;
            text-shadow: 0 0 10px var(--primary), 0 0 20px var(--primary);
            text-transform: uppercase;
        }

        .mode-selector {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            padding: 5px;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .mode-btn {
            border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;
            font-weight: 800; font-size: 12px; color: #666; background: transparent;
            transition: all 0.4s; text-transform: uppercase;
        }

        .mode-btn.active {
            background: var(--primary); color: white;
            box-shadow: 0 0 20px rgba(0, 169, 224, 0.5);
        }

        .main-grid {
            display: grid; grid-template-columns: 320px 1fr 400px;
            gap: 25px; padding: 25px; flex: 1;
        }

        .panel {
            background: var(--panel); border: 1px solid var(--border);
            border-radius: 24px; backdrop-filter: blur(15px);
            padding: 25px; display: flex; flex-direction: column;
        }

        h2 { color: var(--accent); font-size: 13px; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 15px; }

        textarea {
            flex: 1; background: rgba(0, 0, 0, 0.5); border: 1px solid var(--border);
            border-radius: 15px; color: #00FFCC; padding: 15px; font-size: 15px;
            resize: none; outline: none; line-height: 1.6;
        }

        .game-zone { display: flex; flex-direction: column; align-items: center; justify-content: center; }

        .winner-display-box {
            background: radial-gradient(circle, rgba(0, 169, 224, 0.1) 0%, transparent 70%);
            width: 100%; padding: 40px 0; margin-bottom: 20px;
        }

        .winner-name {
            font-size: 72px; font-weight: 900; color: #fff;
            text-shadow: 0 0 30px var(--primary); text-align: center; min-height: 90px;
        }

        .spin-btn {
            width: 200px; height: 200px; border-radius: 50%;
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            border: 8px solid rgba(255,255,255,0.1);
            color: white; font-size: 24px; font-weight: 900; cursor: pointer;
            box-shadow: 0 0 40px rgba(0, 85, 149, 0.6);
            transition: all 0.3s ease; display: flex; flex-direction: column;
            align-items: center; justify-content: center; text-transform: uppercase;
        }

        .spin-btn:hover:not(:disabled) { transform: scale(1.05); box-shadow: 0 0 60px var(--primary); }

        .scenario-box {
            background: rgba(0, 0, 0, 0.4); border: 1px solid var(--border);
            padding: 20px; border-radius: 18px; flex: 1; overflow-y: auto;
        }

        .tag {
            background: rgba(0, 255, 204, 0.1); color: var(--accent);
            border: 1px solid var(--accent); padding: 4px 12px;
            border-radius: 20px; font-size: 10px; font-weight: 800; margin-bottom: 12px;
            display: inline-block;
        }

        .scenario-title { font-size: 18px; font-weight: 800; color: #fff; margin-bottom: 8px; }
        .scenario-context { font-size: 13px; font-style: italic; color: #00A9E0; margin-bottom: 12px; border-left: 2px solid; padding-left: 10px; }
        .scenario-tasks { font-size: 14px; line-height: 1.6; color: #a1a1aa; }
        .scenario-tasks b { color: #fff; }

        .history-item {
            font-size: 12px; color: #52525b; padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            display: flex; justify-content: space-between;
        }

        .student-count { margin-top: 15px; font-size: 11px; font-weight: 800; color: var(--secondary); text-align: center; }
    </style>
</head>
<body>

    <header>
        <div class="logo-text">THE CHOSEN ONE</div>
        <div class="mode-selector">
            <button class="mode-btn active" id="btnMode1" onclick="setMode(1)">BUỔI 1: CƠ BẢN</button>
            <button class="mode-btn" id="btnMode2" onclick="setMode(2)">BUỔI 2: HỎI ĐÁP</button>
        </div>
    </header>

    <div class="main-grid">
        <div class="panel">
            <h2>Hàng chờ tuyển chọn</h2>
            <textarea id="nameList" placeholder="Nhập tên học viên (mỗi dòng 1 tên)..."></textarea>
            <div id="countDisplay" class="student-count">0 CHIẾN BINH ĐANG ĐỢI</div>
        </div>

        <div class="game-zone">
            <div id="statusLabel" style="font-size: 11px; letter-spacing: 4px; color: var(--primary); font-weight: 900; margin-bottom: 10px;">AWAITING COMMAND</div>
            <div class="winner-display-box">
                <div id="winnerName" class="winner-name">---</div>
            </div>
            <button class="spin-btn" id="spinBtn" onclick="startSpin()">
                <span style="font-size: 12px; opacity: 0.8;">Bấm để</span>
                CHỌN NGAY
            </button>
            <div id="turnLabel" style="margin-top:25px; font-size:13px; font-weight: bold; color: var(--secondary);">ĐÃ CHỌN: 0</div>
        </div>

        <div class="panel">
            <h2>Thử thách định mệnh</h2>
            <div class="scenario-box" id="scenarioBox">
                <div style="text-align: center; opacity: 0.3; margin-top: 60px;">Chưa có ai được chọn...</div>
            </div>
            <div id="historyList" style="margin-top: 20px; max-height: 150px; overflow-y: auto;"></div>
            <button onclick="resetGame()" style="margin-top: 15px; background: none; border: 1px solid #27272a; color: #52525b; cursor: pointer; padding: 8px; font-size: 10px; border-radius: 8px;">HỆ THỐNG LÀM MỚI</button>
        </div>
    </div>

    <audio id="soundTick" src="https://www.soundjay.com/buttons/sounds/button-27.mp3"></audio>
    <audio id="soundWin" src="https://www.soundjay.com/misc/sounds/magic-chime-01.mp3"></audio>

    <script>
        const SCENARIOS_S1 = [
            { title: "Tạp hóa: Luồng 6 bước", tag: "Bán lẻ", context: "Cửa hàng 'Tạp hóa Cô Ba' nhập bia, bán lẻ và xử lý hàng lỗi.", tasks: "<b>Nhiệm vụ:</b> Nhập 10 thùng Tiger -> Bán lẻ 2 thùng -> Trả lại 1 lon móp -> Kiểm tra công nợ & báo cáo lãi lỗ." },
            { title: "Thời trang: Luồng 6 bước", tag: "Thời trang", context: "Shop 'Xinh' nhập váy, bán cho khách VIP và đổi trả.", tasks: "<b>Nhiệm vụ:</b> Nhập lô Váy hoa (20 cái) -> Bán cho khách VIP (nợ tiền) -> Khách đổi ý trả lại lấy mẫu khác -> Kiểm tra tồn kho." },
            { title: "Điện máy: Luồng 6 bước", tag: "Điện máy", context: "Cửa hàng điện máy xử lý bảo hành/trả hàng.", tasks: "<b>Nhiệm vụ:</b> Nhập 5 Nồi cơm Sharp -> Bán cho anh Tuấn -> Anh Tuấn báo lỗi, trả hàng -> Thực hiện luồng trả và xem báo cáo." }
        ];

        const SCENARIOS_S2 = [
            { 
                title: "Người 1: Quản lý nhân viên & Hàng hóa", 
                tag: "Thiết lập ban đầu", 
                context: "Shop Mẹ & Bé cần tuyển nhân viên mới tên 'Lan'.", 
                tasks: "<b>Nhiệm vụ:</b><br>1. Tạo tài khoản nhân viên Lan.<br>2. Thêm 'Bỉm Nhật' (Có thuộc tính Size).<br>3. Thêm dịch vụ 'Gói quà sinh nhật'.<br>4. Tạo bảng giá sỉ (> 10 cái).<br>5. Thêm nhanh sản phẩm mới ngay trên phiếu nhập." 
            },
            { 
                title: "Người 2: Giá vốn & Nhập hàng nâng cao", 
                tag: "Nhập hàng", 
                context: "Cửa hàng điện thoại nhập iPhone 15 với giá biến động.", 
                tasks: "<b>Nhiệm vụ:</b><br>1. Nhập nhiều mức giá cho cùng 1 SP.<br>2. Đổi giá bán ngay khi đang nhập hàng.<br>3. Giải thích cột 'Giá vốn trung bình'.<br>4. Tra cứu theo Nhóm hàng (Apple) & Thuộc tính (Màu Titan)." 
            },
            { 
                title: "Người 3: Xử lý bán hàng & Trả hàng", 
                tag: "Giao dịch", 
                context: "Khách đang thanh toán thì muốn mua thêm đồ và trả lại đồ cũ.", 
                tasks: "<b>Nhiệm vụ:</b><br>1. Màn hình bán hàng: Thêm nhanh hàng hóa chưa có.<br>2. Thu nợ khách ngay trên màn hình bán.<br>3. Tạo phiếu trả hàng nhanh.<br>4. Vào thiết lập: Cài đặt thời gian trả hàng là 3 ngày." 
            },
            { 
                title: "Người 4: Khách hàng & Sổ quỹ", 
                tag: "Quản lý & Sổ quỹ", 
                context: "Cuối tháng, rà soát kho và thanh toán chi phí điện nước.", 
                tasks: "<b>Nhiệm vụ:</b><br>1. Tạo nhóm khách hàng VIP.<br>2. Tạo phiếu kiểm kho toàn bộ.<br>3. Tạo phiếu kiểm kho riêng nhóm 'Thực phẩm'.<br>4. Lập phiếu chi tiền điện (2 triệu).<br>5. Thêm tài khoản ngân hàng mới." 
            },
            { 
                title: "Người 5: Luồng cơ bản 6 bước", 
                tag: "Ôn tập", 
                context: "Shop Gia dụng nhập Chảo, bán ghi nợ, trả hàng.", 
                tasks: "<b>Yêu cầu:</b> Demo mượt mà luồng 6 bước cơ bản. Xem báo cáo cuối ngày." 
            },
            { 
                title: "Người 6: Luồng cơ bản 6 bước", 
                tag: "Ôn tập", 
                context: "Siêu thị mini nhập Sữa tươi, quét mã vạch bán hàng.", 
                tasks: "<b>Yêu cầu:</b> Demo mượt mà luồng 6 bước cơ bản. Kiểm tra doanh thu." 
            }
        ];

        let currentMode = 1;
        let spinCount = 0;
        let isSpinning = false;

        const nameListInput = document.getElementById('nameList');
        const countDisplay = document.getElementById('countDisplay');
        const winnerDisplay = document.getElementById('winnerName');
        const scenarioBox = document.getElementById('scenarioBox');

        function updateCount() {
            countDisplay.innerText = `${getNames().length} CHIẾN BINH ĐANG ĐỢI`;
        }
        nameListInput.addEventListener('input', updateCount);

        function getNames() {
            return nameListInput.value.split('\n').filter(n => n.trim() !== "");
        }

        function setMode(mode) {
            currentMode = mode;
            document.getElementById('btnMode1').classList.toggle('active', mode === 1);
            document.getElementById('btnMode2').classList.toggle('active', mode === 2);
            resetGame(false);
        }

        function resetGame(clearNames = true) {
            spinCount = 0;
            winnerDisplay.innerText = "---";
            document.getElementById('turnLabel').innerText = "ĐÃ CHỌN: 0";
            scenarioBox.innerHTML = '<div style="text-align: center; opacity: 0.3; margin-top: 60px;">Sẵn sàng tuyển chọn mới.</div>';
            document.getElementById('historyList').innerHTML = "";
            if(clearNames) nameListInput.value = "";
            updateCount();
        }

        function startSpin() {
            const names = getNames();
            if (names.length === 0) return alert("Hết học viên!");
            if (isSpinning) return;

            isSpinning = true;
            document.getElementById('spinBtn').disabled = true;
            
            let startTime = Date.now();
            const timer = setInterval(() => {
                winnerDisplay.innerText = names[Math.floor(Math.random() * names.length)];
                document.getElementById('soundTick').play().catch(()=>{});
                if (Date.now() - startTime > 1500) {
                    clearInterval(timer);
                    finishSpin(names);
                }
            }, 70);
        }

        function finishSpin(names) {
            const winIndex = Math.floor(Math.random() * names.length);
            const winner = names[winIndex];
            winnerDisplay.innerText = winner;
            spinCount++;
            document.getElementById('turnLabel').innerText = `ĐÃ CHỌN: ${spinCount}`;

            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            document.getElementById('soundWin').play().catch(()=>{});

            // Lấy nhiệm vụ
            let task;
            if (currentMode === 1) {
                task = SCENARIOS_S1[Math.floor(Math.random() * SCENARIOS_S1.length)];
            } else {
                // Buổi 2 lấy theo thứ tự từ 1-6, nếu quá thì lấy ngẫu nhiên 2 cái cuối
                task = SCENARIOS_S2[spinCount - 1] || SCENARIOS_S2[4 + Math.floor(Math.random()*2)];
            }

            scenarioBox.innerHTML = `
                <span class="tag">${task.tag}</span>
                <div class="scenario-title">${task.title}</div>
                <div class="scenario-context">${task.context}</div>
                <div class="scenario-tasks">${task.tasks}</div>
            `;

            // XÓA TÊN
            const updatedNames = names.filter((_, idx) => idx !== winIndex);
            nameListInput.value = updatedNames.join('\n');
            updateCount();

            const hist = document.createElement('div');
            hist.className = 'history-item';
            hist.innerHTML = `<span>${spinCount}. ${winner}</span> <span>${task.tag}</span>`;
            document.getElementById('historyList').prepend(hist);

            isSpinning = false;
            document.getElementById('spinBtn').disabled = false;
        }
    </script>
</body>
</html>
